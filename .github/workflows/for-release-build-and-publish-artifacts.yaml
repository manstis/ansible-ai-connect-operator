name: "[Release] Build and publish Operator, Bundle and Catalog artifacts"

on:
  push:
    branches: [main]

jobs:

  get_operator_versions:
    uses: ./.github/workflows/common-get-operator-versions.yaml
    secrets: inherit

  get_service_version:
    uses: ./.github/workflows/common-get-service-version.yaml
    secrets: inherit

  debug:
    runs-on: ubuntu-latest
    needs: [get_operator_versions, get_service_version]

    steps:

      - name: Debug
        id: debug
        run: |
          echo "operator_version_latest: ${{ needs.get_operator_versions.operator_version_latest }}"
          echo "operator_version_next: ${{ needs.get_operator_versions.operator_version_next }}"
          echo "cheese: ${{ needs.get_operator_versions.cheese }}"

  build:
    uses: ./.github/workflows/common-release-build-and-publish-artifacts.yaml
    needs: [get_operator_versions, get_service_version]
    with:
      operator_version_latest: ${{ needs.get_operator_versions.operator_version_latest }}
      operator_version_next: ${{ needs.get_operator_versions.operator_version_next }}
      service_version: ${{ needs.get_service_version.service_version }}
    secrets: inherit
