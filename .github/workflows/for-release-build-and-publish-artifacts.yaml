name: "[Release] Build and publish Operator, Bundle and Catalog artifacts"

on:
  push:
    branches: [main]

jobs:

  get_operator_versions:
    uses: ./.github/workflows/common-get-operator-versions.yaml
    secrets: inherit

  debug:
    runs-on: ubuntu-latest
    needs: get_operator_versions

    steps:

      - name: Debug
        id: debug
        run: |
          echo "operator_version_latest: ${{ needs.get_operator_versions.operator_version_latest }}"
          echo "operator_version_next: ${{ needs.get_operator_versions.operator_version_next }}"

  build:
    uses: ./.github/workflows/common-release-build-and-publish-artifacts.yaml
    needs: get_operator_versions
    with:
      operator_version_latest: ${{ needs.get_operator_versions.operator_version_latest }}
      operator_version_next: ${{ needs.get_operator_versions.operator_version_next }}
    secrets: inherit
